{% extends "forum/base.html" %}


{% load staticfiles urlquery avatar %}


{% block forum_header %}
    {{ block.super }}
    | <a href="{% url "forum:posts-search" %}">search in posts</a>
    | <a href="{% url "forum:mark-all-topics-read" %}">mark topics as read</a>
    <form action="{% url "forum:posts-search" %}" method="GET">
        <input type="search" name="pattern">
        <button type="submit">Search posts</button>
    </form>
    <form action="{% url "forum:topics-list" %}" method="GET">
        <div class="subheader">
            {% for tag in tags %}
                <label>
                    <input type="checkbox" name="tag" value="{{ tag.label }}" {% if tag.checked %}checked{% endif %}> {{ tag.label }}
                </label>
            {% endfor %}
            <button type="submit">Filter topics</button>
        </div>
    </form>
{% endblock %}


{% block forum_content %}

    <div class="table expand topic-list">
        {% for topic in topics %}
            <div class="row">
                <div class="col">
                    {% avatar_tag topic.author.email 36 %}
                </div>
                <div class="col fluid-1">
                    <span data-dynamic-widget="topic-is-new:{{ topic.id }}">unread</span>
                </div>
                <div class="col topic-col">
                    <a href="{{ topic.get_absolute_url }}">{{ topic.subject }}</a><br/>
                    <span class="tag solved">solved</span>
                    <span class="tag closed">closed</span>
                    {% for tag in topic.tags.all %}<span class="tag">{{ tag }}</span>{% endfor %}
                </div>
                <div class="col fluid-1 right-align">
                    {{ topic.response_count }} posts
                </div>
                <div class="col fluid-1 right-align">
                    <span data-dynamic-widget="topic-view-count:{{ topic.id }}"></span> views
                </div>
                <div class="col fluid-2 right-align">
                    <span title="{{ topic.updated }}">{{ topic.updated|timesince }} ago</span>
                </div>
            </div>
        {% empty %}
            No topics
        {% endfor %}
    </div>

    <div class="pagination">
        {% if topics.has_previous %}
        <a href="?{% urlquery_set request page=topics.previous_page_number %}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ topics.number }} of {{ topics.paginator.num_pages }}.
        </span>

        {% if topics.has_next %}
            <a href="?{% urlquery_set request page=topics.next_page_number %}">next</a>
        {% endif %}
    </div>
{% endblock %}
